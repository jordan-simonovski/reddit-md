var lastParsed = 0;
var assert = require('assert')

var totalApiCalls = 0;
var totalPages = 0;
var total = 0;

function wrapper(username, callback) {
    var test = require('../index.js')
    console.log(test);

    var submissionCount = 0;
    var commentCount = 0;

    test(username, lastParsed)
        .on('user', function(userObj) {
            console.log(userObj);
        })
        .on('submission', function(submission) {
            submissionCount += 1;
        })
        .on('comment', function(comment) {
            //console.log('comment found!');
            commentCount += 1;
        })
        .on('api_call', function(metrics) {
            console.log(metrics + ' requests per second');
            totalApiCalls += 1;
        })
        .on('page', function(after, count) {
            total += count;
            totalPages += 1;
            console.log('page complete found',
                'submission: ', submissionCount, 'comment', commentCount, 'total', total);
        })
        .on('data', function(obj) { //this is a comment or submission that is pushed
            if (obj.data.created > lastParsed) lastParsed = obj.data.created;
        })
        .on('end', function() {
            console.log('end')
            console.log('parse complete found',
                'submission: ', submissionCount, 'comment', commentCount, 'total', total);
            callback();
        })
        .on('error', function(err) {
            //console.log('err', err)
            throw (err)
        });
}
wrapper('hortinstein', function(e, r) {
    // wrapper('hortinstein', function() {
    //     assert.equal(totalPages, totalApiCalls);
    // });
});
wrapper('nina1987', function(e, r) {
    wrapper('hortinstein', function() {

    });
});